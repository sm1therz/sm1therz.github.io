"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[33281],{11724:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.remoteCall=void 0;let n=r(92632);async function o(e){try{let t=await e.text();return t.length>5e3?`${t.substring(0,5e3)}... (truncated; len=${t.length})`:t}catch(e){return n.consoleLog.error("Failed to get error response body",e),"(failed to get response body; see logs)"}}t.remoteCall=async function(e,t={}){let r,i,{payload:s,timeoutMs:l=6e5,userAgent:a=`remote-call timeout=${l}ms`,fetch:u=globalThis.fetch,debug:c=!1,...d}=t;if(!u)throw Error("remoteCall: fetch not available as global, specify it with opts.fetch");d.headers={...d.headers||{},Accept:"application/json","User-Agent":`remote-call timeout=${l}`},s&&(d.body=JSON.stringify(s),d.headers={...d.headers,"Content-Type":"application/json"});let p=new Date,f=!1;"undefined"!=typeof AbortController&&l>0&&(i=new AbortController,r=setTimeout(()=>{f||(c&&n.consoleLog.debug(`Aborting ${d.method||"GET"} ${e} after ${new Date().getTime()-p.getTime()}ms, timeout=${l}ms`),i.abort())},l));try{let t=await u(e,{...d,signal:i?.signal||null});if(f=!0,clearTimeout(r),!t.ok)return Promise.reject(Error(`${t.status} ${t.statusText} ${await o(t)}`));return t.json()}catch(t){if(clearTimeout(r),t?.name==="AbortError")return Promise.reject(Error(`${d.method||"GET"} ${e} timeouts after ${new Date().getTime()-p.getTime()}ms (configured timeout ${l}ms). Execution started at ${p.toISOString()}. Cause: ${t?.message||"unknown"}`));return Promise.reject(t)}}},18639:(e,t,r)=>{var n=r(40459);Object.defineProperty(t,"__esModule",{value:!0}),t.segmentDriver=void 0;let o=r(31773),i=r(23382),s=r(70190),l=r(11724);async function a(e,{fetch:t,log:r},a){var u;let c=a.key||n.env.SEGMENT_KEY;if(!c)throw Error("Segment driver is misconfigured. Either opts.key option, or SEGMENT_KEY env car should be present");let d=[],p=new Date().toISOString(),f={ip:e.ipAddress,campaign:(u=e.utms||{},(0,o.mapKeys)(u,e=>0===e.indexOf("utm_")?e.substring(4):e)),locale:e.userLanguage,page:{referrer:e.referrer,search:e.queryString,userAgent:e.userAgent},library:{name:"nextjs-collect"}};!a?.disableIdentify&&(e.user?.id||e.user?.anonymousId)&&d.push({type:"identify",anonymousId:e.user?.anonymousId,userId:e.user?.id,traits:(0,o.removeProps)(e.user||{},"anonymousId","userId"),timestamp:p});let[g,m]=(0,o.splitObject)(e,i.defaultPageEventProps);return"page_view"===g.eventType?d.push({type:"page",anonymousId:e.user?.anonymousId,userId:e.user?.id,name:e.title||e.path,context:f,properties:m}):d.push({type:"track",event:g.eventType,anonymousId:e.user?.anonymousId,userId:e.user?.id,context:f,properties:m}),(0,l.remoteCall)("https://api.segment.io/v1/batch",{debug:(0,i.isDebug)(),method:"POST",headers:{Authorization:`Basic ${c}`,"User-Agent":(0,s.getUserAgent)()},payload:{batch:d,context:f}})}t.segmentDriver=e=>(t,r)=>a(t,r,e)},23382:(e,t,r)=>{var n=r(40459);Object.defineProperty(t,"__esModule",{value:!0}),t.defaultCollectApiRoute=t.getQueryString=t.getFullUrl=t.isClickId=t.isUtmCode=t.isDefaultPort=t.getEventHandler=t.safeCall=t.parseEventTypesMap=t.randomId=t.parseDriverShortcut=t.getClickIdsFromQueryString=t.getUtmsFromQueryString=t.isDebug=t.defaultPageEventProps=t.getHostWithPort=t.knownClickIdNames=t.knownUtmCodeNames=t.allDrivers=t.getNextCollectLog=t.nextCollectProtocolVersion=void 0;let o=r(96033),i=r(31773),s=r(18639),l=r(98687),a=r(26999),u=r(92632);t.nextCollectProtocolVersion="1",t.getNextCollectLog=u.getLog,t.allDrivers={jitsu:o.jitsuDriver,segment:s.segmentDriver,postgrest:l.postgrestDriver,echo:a.echoDriver,custom:(e,t)=>e.handler},t.knownUtmCodeNames=["utm_source","utm_medium","utm_campaign","utm_term","utm_content"];let c=new Set(t.knownUtmCodeNames.map(e=>e.toLowerCase()));t.knownClickIdNames=["gclid","fbclid","dclid"];let d=new Set(t.knownClickIdNames.map(e=>e.toLowerCase()));function p(e){return`${e.host}${e.port&&":"+e.port}`}function f(e){return c.has(e.toLowerCase())}function g(e){return d.has(e.toLowerCase())}function m(e){return 0===Object.keys(e.queryString).length?"":"?"+Object.entries(e.queryString).map(([e,t])=>`${e}=${encodeURIComponent(t)}`).join("&")}t.getHostWithPort=p,t.defaultPageEventProps=["httpMethod","timestamp","clickIds","eventId","eventType","host","ipAddress","localTimezoneOffset","path","queryString","referrer","screenResolution","title","url","user","userAgent","userLanguage","utms","viewportSize"],t.isDebug=function(){return!!n.env.NEXT_COLLECT_DEBUG},t.getUtmsFromQueryString=function(e){return Object.entries(e).filter(([e])=>f(e)).reduce((e,[t,r])=>({...e,[t.toLowerCase()]:r}),{})},t.getClickIdsFromQueryString=function(e){return Object.entries(e).filter(([e])=>g(e)).reduce((e,[t,r])=>({...e,[t.toLowerCase()]:r}),{})},t.parseDriverShortcut=function(e){if(!e)return[];if("string"==typeof e)return[{type:e,opts:{}}];if("function"==typeof e)return[{type:"custom",opts:{handler:e}}];if(Array.isArray(e))return e.filter(e=>!!e).map(e=>"string"==typeof e?{type:e,opts:{}}:"function"==typeof e?{type:"custom",opts:{handler:e}}:e);throw Error(`Invalid type ${typeof e}`)},t.randomId=function(){return Math.random().toString(36).substring(2)},t.parseEventTypesMap=function(e){if(!e)return()=>"page_view";if("function"==typeof e)return e;if(Array.isArray(e)){let t=(0,i.createPrefixMap)(e.map(e=>Array.isArray(e)?[e]:Object.entries(e)).flat(1));return e=>t.get(e)||null}if("object"==typeof e){let t=(0,i.createPrefixMap)(Object.entries(e));return e=>t.get(e)||null}throw Error(`Wrong type ${typeof e}`)},t.safeCall=function(e,t,r){try{return e()}catch(e){return u.consoleLog.error(`Failed to get ${t}: ${e?.message||"Unknown error"}`,e),r}},t.getEventHandler=function(e){let r=t.allDrivers[e.type];if(!r)throw Error(`Unknown driver ${e.type}`);return r(e.opts||{})},t.isDefaultPort=function(e,t){return"http"===e&&"80"===t||"https"===e&&"443"===t?void 0:t},t.isUtmCode=f,t.isClickId=g,t.getFullUrl=function(e){return`${e.protocol}://${p(e)}${e.path}${m(e)}`},t.getQueryString=m,t.defaultCollectApiRoute="/api/collect"},26999:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.echoDriver=void 0;let n=r(31773),o={underscore:"\x1b[4m",italic:"\x1b[3m",bold:"\x1b[1m",black:"\x1b[30m",red:"\x1b[31m",green:"\x1b[32m",yellow:"\x1b[33m",blue:"\x1b[34m",magenta:"\x1b[35m",cyan:"\x1b[36m",white:"\x1b[37m",gray:"\x1b[90m",bgBlack:"\x1b[40m",bgRed:"\x1b[41m",bgGreen:"\x1b[42m",bgYellow:"\x1b[43m",bgBlue:"\x1b[44m",bgMagenta:"\x1b[45m",bgCyan:"\x1b[46m",bgWhite:"\x1b[47m"},i=Object.entries(o).reduce((e,[t,r])=>({...e,[t]:e=>`${r}${e}\x1b[0m`}),{}),s=Object.entries(o).reduce((e,[t])=>({...e,[t]:e=>e}),{});t.echoDriver=e=>{let t=e.disableColor?s:i,r=e?.format||"table";return(e,{log:o})=>(o.log(`${t.bold(t.green("NextCollect/EchoDriver"))} processing event ${t.bold(e.eventType||"unknown_event")} `+("json"===r?JSON.stringify(e):"\n"+function(e,t){let r=(0,n.flatten)(e,{delimiter:"."}),o=Math.max(...Object.keys(r).map(e=>e.length));return Object.entries(r).map(([e,r],n)=>{let i=e.padEnd(o);return`	${(n+1).toString().padStart(3)}. ${t.bold(i)} : ${r}`}).join("\n")}(e,t))),Promise.resolve())}},31773:(e,t)=>{function r(e){return e&&"object"==typeof e&&!Array.isArray(e)}function n(e,t,r){let o=[...t];if(1===o.length){e[o[0]]=r;return}let i=o.shift();void 0===e[i]&&(e[i]={}),n(e[i],o,r)}function o(e,t){if(1===t.length)return void delete e[t[0]];let r=t.shift();void 0!==e[r]&&o(e[r],t)}function i(e,t){let r=[...t];if(1===r.length)return e[r[0]];let n=r.shift();if(void 0!==e[n])return i(e[n],r)}function s(e){return"object"!=typeof e||null===e?e:Array.isArray(e)?e.map(s):Object.entries(e).reduce((e,[t,r])=>({...e,[t]:s(r)}),{})}function l(e,t){return Object.entries(e).map(([e,r])=>[t(e),r]).reduce((e,[t,r])=>({...e,[t]:r}),{})}Object.defineProperty(t,"__esModule",{value:!0}),t.flatten=t.mapKeys=t.deepMerge=t.splitObject=t.asArray=t.deepClone=t.deepGet=t.deepDelete=t.deepSet=t.isObject=t.createPrefixMap=t.removeProps=t.renameProps=t.sanitizeObject=t.removeSuffix=void 0,t.removeSuffix=function(e,t){for(let r of"string"==typeof t?[t]:t)for(;e.lastIndexOf(r)===e.length-r.length;)e=e.substring(0,e.length-r.length);return e},t.sanitizeObject=function e(t,r={}){let{undefs:n="remove",removeFunctions:o=!1}=r;if(null===t)throw Error("sanitizeObject(null) can't be called");if("object"!=typeof t)throw Error(`Wrong type ${typeof t} - expected object`);return Array.isArray(t)?("remove"===n?t.filter(e=>void 0!==e):t).map(t=>void 0===t?null:"object"==typeof t?e(t,r):t):("remove"===n?Object.entries(t).filter(([,e])=>void 0!==e):Object.entries(t)).reduce((t,[n,o])=>null==o?{...t,[n]:null}:"object"==typeof o?{...t,[n]:e(o,r)}:{...t,[n]:o},{})},t.renameProps=function(e,t){return Object.entries(e).reduce((e,[r,n])=>({...e,[t[r]||r]:n}),{})},t.removeProps=function(e,...t){let r=new Set(t);return Object.entries(e).filter(([e])=>r.has(e)).reduce((e,[t,r])=>({...e,[t]:r}),{})},t.createPrefixMap=function(e){let t=[],r=[],n=new Map;for(let[o,i]of e){let e=o.indexOf("*"),s=o.lastIndexOf("*");if(e<0&&s<0)n.set(o,i);else if(e>=0&&s>=0&&e!==s)throw Error(`Invalid pattern ${o}. So far we support only one wildcard that should be at the end or beginning of url. Found at least two wildcards`);else if(e===o.length-1)t.push([o.substring(0,o.length-1),i]);else if(0===e)r.push([o.substring(1),i]);else throw Error(`Invalid pattern ${o}. So far we support only one wildcard that should be at the end or beginning of url. Found at least two wildcards`)}return{get(e){let o=n.get(e);if(void 0!==o)return o;let i=t.find(([t])=>e.startsWith(t));if(i&&null===i[1])return i[1];let s=r.find(([t])=>e.endsWith(t));return s&&null===s[1]?s[1]:(i||s||[void 0,void 0])[1]}}},t.isObject=r,t.deepSet=n,t.deepDelete=o,t.deepGet=i,t.deepClone=s,t.asArray=function(e){return Array.isArray(e)?e:[e]},t.splitObject=function(e,t){let r={},l=s(e);for(let s of t.map(e=>Array.isArray(e)?e:[e])){let t=i(e,s);n(r,s,t),o(l,s)}return[r,l]},t.deepMerge=function e(t,...n){if(!n.length)return t;let o=n.shift();if(r(t)&&r(o))for(let n in o)r(o[n])?(t[n]||Object.assign(t,{[n]:{}}),e(t[n],o[n])):void 0!==o[n]&&Object.assign(t,{[n]:o[n]});return e(t,...n)},t.mapKeys=l,t.flatten=function e(t,r){return Object.entries(t).reduce((t,[n,o])=>{if((r?.stopPaths||[]).find(e=>e===n||1===e.length&&e[0]===n))return{...t,[n]:o};if(null==o)return{...t,[n]:null};if(Array.isArray(o))return{...t,[n]:JSON.stringify(o)};if("object"!=typeof o)return{...t,[n]:o};{let i=l(e(o,{...r,stopPaths:r?.stopPaths&&r?.stopPaths.filter(e=>Array.isArray(e)&&e.length>1).map(e=>e.slice(1))}),e=>`${n}${r?.delimiter||"_"}${e}`);return{...t,...i}}},{})}},33281:function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);(!o||("get"in o?!t.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return o(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.useCollector=t.EventCollectionProvider=t.EventCollectionContext=void 0;let s=i(r(7620)),l=r(23382),a=r(31773),u=r(92632);t.EventCollectionContext=(0,s.createContext)(null),t.EventCollectionProvider=({children:e,options:r})=>{let n=t.EventCollectionContext;return s.default.createElement(n.Provider,{value:r||null},e)},t.useCollector=function(){let e=(0,s.useContext)(t.EventCollectionContext);return{event(t,r={}){let n=function(){let e=new URL(window.location.href),t=(0,a.removeSuffix)(e.protocol,":");return{host:e.host.split(":")[0],path:e.pathname,port:(0,l.isDefaultPort)(t,e.port),protocol:t,queryString:[...e.searchParams].reduce((e,[t,r])=>({...e,[t]:r}),{})}}(),o={event:{eventType:t,clickIds:(0,l.getUtmsFromQueryString)(n.queryString),host:(0,l.getHostWithPort)(n),path:n.path,title:window.document.title,viewportSize:Math.max(document.documentElement.clientWidth||0,window.innerWidth||0)+"x"+Math.max(document.documentElement.clientHeight||0,window.innerHeight||0),screenResolution:screen.width+"x"+screen.height,queryString:(0,l.getQueryString)(n),referrer:window.document.referrer,localTimezoneOffset:new Date().getTimezoneOffset(),url:window.location.href,utms:(0,l.getUtmsFromQueryString)(n.queryString),...r}};fetch(e?.apiPath||l.defaultCollectApiRoute,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify((0,a.sanitizeObject)(o))}).then(async t=>{t.ok||u.consoleLog.warn(`Failed to send data to ${e?.apiPath||l.defaultCollectApiRoute}. Status code: ${t.status} `,await t.text())}).catch(t=>{u.consoleLog.warn(`Failed to send data to ${e?.apiPath||l.defaultCollectApiRoute}`,t)})}}}},70190:(e,t)=>{function r(){return"canary"}Object.defineProperty(t,"__esModule",{value:!0}),t.getUserAgent=t.getVersion=void 0,t.getVersion=r,t.getUserAgent=function(){return`next-collect : github.com/jitsucom/next-collect : version=${r()} bot=true`}},92632:(e,t)=>{function r(e,t,r,n,o){if(!n)return void e("");let i=new Date().toISOString().replace("T"," ").replace("Z","")+" UTC",s=`[${t.toUpperCase()}]`.padEnd(5),l=`${i} ${s}${r?` (${r}) `:""}- ${n}`;o.length>0?e(l,...o):e(l)}function n(e){return"function"==typeof e?e():e}function o(e){let t={error(t,...o){r(console.error,"error",n(e),t,o)},warn(t,...o){r(console.warn,"warn",n(e),t,o)},info(t,...o){r(console.info,"info",n(e),t,o)},debug(t,...o){r(console.info,"debug",n(e),t,o)}};return{log:t.info,...t}}Object.defineProperty(t,"__esModule",{value:!0}),t.getLog=t.consoleLog=void 0,t.consoleLog=o(`next-collect/${"undefined"==typeof window?"server":"client"}`),t.getLog=o},96033:(e,t,r)=>{var n=r(40459);Object.defineProperty(t,"__esModule",{value:!0}),t.jitsuDriver=void 0;let o=r(31773),i=r(23382),s=r(70190),l=r(11724);async function a(e,{fetch:t,log:r},a){let u=a.key||n.env.JITSU_KEY;if(!u)throw Error("Jitsu driver is mis-configured. Either opts.key option, or JITSU_KEY env car should be defined");let[c,d]=(0,o.splitObject)(e,i.defaultPageEventProps),p=`${(0,o.removeSuffix)(a?.server||n.env.JITSU_SERVER||"https://t.jitsu.com","/")}/api/v1/s2s/event`,f={event_type:c.eventType,screen_resolution:c.screenResolution,user_agent:c.userAgent,referer:c.referrer,url:c.url,page_title:c.title,doc_path:c.path,doc_host:c.host,doc_search:c.queryString,vp_size:c.viewportSize,user_language:c.userLanguage,source_ip:c.ipAddress,user:(0,o.renameProps)(c.user,{anonymousId:"anonymous_id"}),ids:{},local_tz_offset:c.localTimezoneOffset,utm:(0,o.mapKeys)(c.utms,e=>0===e.indexOf("utm_")?e.substring(4):e),click_id:c.clickIds,...d},g=(0,o.sanitizeObject)(f);await (0,l.remoteCall)(p,{debug:(0,i.isDebug)(),method:"POST",headers:{"X-Auth-Token":u,"User-Agent":(0,s.getUserAgent)()},payload:g})}t.jitsuDriver=e=>(t,r)=>a(t,r,e)},98687:(e,t,r)=>{var n=r(40459);Object.defineProperty(t,"__esModule",{value:!0}),t.postgrestDriver=void 0;let o=r(23382),i=r(31773),s=r(70190),l=r(11724);async function a(e,{fetch:t,log:r},a){var u;let c=a.url||n.env.POSTGREST_URL,d=a?.apiKey||n.env.POSTGREST_API_KEY,p=[...o.defaultPageEventProps,["page"],["user","email"],["user","id"],["user","anonymousId"],...a?.extraColumns||[]],[f,g]=(0,i.splitObject)(e,p),m={...(0,i.flatten)(f,{stopPaths:["utms","clickIds","page"]}),extra:g,timestamp:f.timestamp||new Date,queryParams:e.queryString&&e.queryString.length>0?(u=e.queryString).substring(u.indexOf("?")+1).split("&").reduce((e,t)=>{let[r,n]=t.split("=");return{...e,[r]:n&&decodeURIComponent(n)}},{}):{}};if(!c)throw Error("Please define opts.url or env.POSTGREST_URL");if(!d)throw Error("Please define opts.apiKey or env.POSTGREST_API_KEY");let y={apikey:d,"Content-Type":"application/json",Accept:"application/json",Prefer:"resolution=merge-duplicates","User-Agent":(0,s.getUserAgent)()};return(0,l.remoteCall)(c,{debug:(0,o.isDebug)(),method:"POST",headers:y,payload:m})}t.postgrestDriver=e=>(t,r)=>a(t,r,e)}}]);
//# sourceMappingURL=33281-e3bfa6a0195415f9.js.map